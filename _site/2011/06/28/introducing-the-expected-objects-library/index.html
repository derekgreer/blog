<!DOCTYPE html>
<html lang="en-us">

<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="stylesheet" href="/assets/css/normalize.css"/>
  <link rel="stylesheet" href="/assets/css/bulma.css"/>
  <link rel="stylesheet" href="/assets/css/highlight.css"/>
  <link rel="stylesheet" href="/assets/css/custom.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet">

  <!-- Icons -->
  <link rel="shortcut icon" href="/assets/images/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/AspiringCraftsman">

  <title>
    
      Introducing the Expected Objects Library &middot; Aspiring Craftsman
    
  </title>

</head>


<body>

<section class="hero is-dark">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">Aspiring Craftsman</h1><div>pursuing well-crafted software</div>
<!--
          <span class="typewrite" data-period="2000" data-type='[ "pursuing well-crafted software"]'>
            <span class="wrap"></span>
          </span>
-->
      <!--
      <h4 class="subtitle" id="quote">
      </h4>
      -->
    </div>
  </div>
</section>

<div class="main-container">
  <div class="tile is-ancestor is-vertical">


    <nav class="nav has-shadow">

      <div class="nav-left">

        <a href="/" class="nav-item">
          <span class="icon">
            <i class="fa fa-home" aria-hidden="true" title="Homepage"></i>
          </span>
        </a>

        <a href="https://github.com/" class="nav-item">
          <span class="icon">
            <i class="fa fa-github" aria-hidden="true" title="Github"></i>
          </span>
        </a>

        <div class="nav-item" id="searchFieldNav">
          <div class="field has-addons">
            <p class="control">
              <input class="input is-small" type="text" placeholder="Find an article" id="search-text">
            </p>
            <p class="control">
              <a class="button is-dark is-small" onclick="searchHandler();">
                Search
              </a>
            </p>
          </div>
        </div>

      </div>

      <div class="nav-right nav-menu" id='nav-menu'>
        <a href="/archive" class="nav-item">Archive</a>
        <a href="/tags" class="nav-item">Tags</a>
        <a href="http://feeds.feedburner.com/AspiringCraftsman" class="nav-item"><img src="/assets/images/rss.png"/></a>
      </div>

      <span class="nav-toggle" id="nav-toggle">
          <span></span>
          <span></span>
          <span></span>
    </nav>

    <div class="tile is-parent">
      <div class="tile is-8 is-child main">

        <div class="box">
    <h1 class="post-title">Introducing the Expected Objects Library</h1>
    <span class="post-meta">28 June, 2011. It was a Tuesday. <a style="color:grey" href="#disqus_thread"></a></span><hr/>

    <span class="post-text"><p>Introduced <noindex></noindex> in the <a href="http://lostechies.com/derekgreer/2011/03/07/effective-tests-introduction/">Effective Test Series</a>, the <a href="http://lostechies.com/derekgreer/2011/06/24/effective-tests-expected-objects/">Expected Object</a> pattern is a technique involving the encapsulation of test-specific logic within a specialized type designed to compare its configured state against that of another object. Use of the Expected Object pattern eliminates the need to encumber system objects with test-specific equality behavior, helps to reduce test code duplication and can aid in expressing the logical intent of automated tests.</p>

<p>While the Expected Object pattern is a great strategy for helping adhere to good testing practices, the process of actually implementing the required types can be less than motivating. To alleviate the burden of hand-rolling Expected Object types, I created the <a href="http://nuget.org/List/Packages/ExpectedObjects">Expected Objects</a> library. This library provides the ability to compare the state of one object against another without relying upon the provided type’s equality members. In addition to the ability to assert equality, the library also provides equality assertion methods which provide feedback of how each member of an object differs from an expected state.</p>

<p>The following examples demonstrate the capabilities of the library:</p>

<h3> </h3>

<h3 id="comparing-flat-objects">Comparing Flat Objects</h3>

<pre class="prettyprint">public class when_retrieving_a_customer
{
	static Customer _actual;
	static ExpectedObject _expected;

	Establish context = () =&gt;
		{
			_expected = new Customer
				            {
				            	Name = "Jane Doe",
				            	PhoneNumber = "5128651000"
				            }.ToExpectedObject();

			_actual = new Customer
				          {
				          	Name = "John Doe",
				          	PhoneNumber = "5128654242"
				          };
		};

	It should_return_the_expected_customer = () =&gt; _expected.ShouldEqual(_actual);
}



class Customer
{
	public string Name { get; set; }
	public string PhoneNumber { get; set; }
}
</pre>

<p>Results:</p>

<pre><div style="overflow: auto; border-bottom: black 1px solid; text-align: left; border-left: black 1px solid; padding-bottom: 5px; background-color: #fcc; padding-left: 5px; padding-right: 5px; border-collapse: collapse; border-top: black 1px solid; border-right: black 1px solid">
  <b>should return the expected customer : Failed</b>
  For Customer.Name, expected "Jane Doe" but found "John Doe".
  For Customer.PhoneNumber, expected "5128651000" but found "5128654242". 
  
</div>
</pre>

<h3 id="-1"> </h3>

<h3 id="comparing-composed-objects">Comparing Composed Objects</h3>

<pre class="prettyprint">public class when_retrieving_a_customer_with_address
{
	static Customer _actual;
	static ExpectedObject _expected;

	Establish context = () =&gt;
		{
			_expected = new Customer
				            {
				            	Name = "Jane Doe",
				            	PhoneNumber = "5128651000",
				            	Address = new Address
				            		          {
				            		          	AddressLineOne = "123 Street",
				            		          	AddressLineTwo = string.Empty,
				            		          	City = "Austin",
				            		          	State = "TX",
				            		          	Zipcode = "78717"
				            		          }
				            }.ToExpectedObject();

			_actual = new Customer
				          {
				          	Name = "John Doe",
				          	PhoneNumber = "5128654242",
				          	Address = new Address
				          		          {
				          		          	AddressLineOne = "456 Street",
				          		          	AddressLineTwo = "Apt. 3",
				          		          	City = "Waco",
				          		          	State = "TX",
				          		          	Zipcode = "76701"
				          		          }
				          };
		};

	It should_return_the_expected_customer = () =&gt; _expected.ShouldEqual(_actual);
}



class Customer
{
	public string Name { get; set; }
	public string PhoneNumber { get; set; }
	public Address Address { get; set; }
}



class Address
{
	public string AddressLineOne { get; set; }
	public string AddressLineTwo { get; set; }
	public string City { get; set; }
	public string State { get; set; }
	public string Zipcode { get; set; }
}
</pre>

<p>Results:</p>

<pre><div style="overflow: auto; border-bottom: black 1px solid; text-align: left; border-left: black 1px solid; padding-bottom: 5px; background-color: #fcc; padding-left: 5px; padding-right: 5px; border-collapse: collapse; border-top: black 1px solid; border-right: black 1px solid">
  <b>should return the expected customer : Failed</b>
  For Customer.Name, expected "Jane Doe" but found "John Doe". 
  For Customer.PhoneNumber, expected "5128651000" but found "5128654242". 
  For Customer.Address.AddressLineOne, expected "123 Street" but found "456 Street". 
  For Customer.Address.AddressLineTwo, expected "" but found "Apt. 3". 
  For Customer.Address.City, expected "Austin" but found "Waco". 
  For Customer.Address.Zipcode, expected "78717" but found "76701".
  
</div>
</pre>

<h3 id="-2"> </h3>

<h3 id="comparing-collections">Comparing Collections</h3>

<pre class="prettyprint">public class when_retrieving_a_collection_of_customers
{
	static List&lt;Customer&gt; _actual;
	static ExpectedObject _expected;

	Establish context = () =&gt;
		{
			_expected = new List&lt;Customer&gt;
				            {
				            	new Customer {Name = "Customer A"},
				            	new Customer {Name = "Customer B"}
				            }.ToExpectedObject();

			_actual = new List&lt;Customer&gt;
				          {
				          	new Customer {Name = "Customer A"},
				          	new Customer {Name = "Customer C"}
				          };
		};

	It should_return_the_expected_customers = () =&gt; _expected.ShouldEqual(_actual);
}
</pre>

<p>Results:</p>

<pre><div style="overflow: auto; border-bottom: black 1px solid; text-align: left; border-left: black 1px solid; padding-bottom: 5px; background-color: #fcc; padding-left: 5px; padding-right: 5px; border-collapse: collapse; border-top: black 1px solid; border-right: black 1px solid">
  <b>should return the expected customers : Failed</b>
  For List`1[1].Name, expected "Customer B" but found "Customer C". 
</div>
</pre>

<h3 id="-3"> </h3>

<h3 id="comparing-dictionaries">Comparing Dictionaries</h3>

<pre class="prettyprint">public class when_retrieving_a_dictionary
{
	static IDictionary&lt;string, string&gt; _actual;
	static IDictionary&lt;string, string&gt; _expected;

	static bool _result;

	Establish context = () =&gt;
		{
			_expected = new Dictionary&lt;string, string&gt; {{"key1", "value1"}};
			_actual = new Dictionary&lt;string, string&gt; {{"key1", "value1"}, {"key2", "value2"}};
		};

	It should_return_the_expected_dictionary = () =&gt; _expected.ToExpectedObject().ShouldEqual(_actual);
}
</pre>

<p>Results:</p>

<pre><div style="overflow: auto; border-bottom: black 1px solid; text-align: left; border-left: black 1px solid; padding-bottom: 5px; background-color: #fcc; padding-left: 5px; padding-right: 5px; border-collapse: collapse; border-top: black 1px solid; border-right: black 1px solid">
  <b>should return the expected dictionary : Failed</b>
  For Dictionary`2[1], expected nothing but found [[key2, value2]]. 
</div>
</pre>

<h3 id="-4"> </h3>

<h3 id="comparing-types-with-indexes">Comparing Types with Indexes</h3>

<pre class="prettyprint">public class when_retrieving_a_type_with_an_index
{
	static IndexType&lt;int&gt; _actual;
	static IndexType&lt;int&gt; _expected;

	static bool _result;

	Establish context = () =&gt;
		{
			_expected = new IndexType&lt;int&gt;(new List&lt;int&gt; {1, 2, 3, 4, 6});
			_actual = new IndexType&lt;int&gt;(new List&lt;int&gt; {1, 2, 3, 4, 5});
		};

	It should_return_the_expected_type = () =&gt; _expected.ToExpectedObject().ShouldEqual(_actual);
}



class IndexType&lt;T&gt;
{
	readonly IList&lt;T&gt; _ints;

	public IndexType(IList&lt;T&gt; ints)
	{
		_ints = ints;
	}

	public T this[int index]
	{
		get { return _ints[index]; }
	}

	public int Count
	{
		get { return _ints.Count; }
	}
}
</pre>

<p>Results:</p>

<pre><div style="overflow: auto; border-bottom: black 1px solid; text-align: left; border-left: black 1px solid; padding-bottom: 5px; background-color: #fcc; padding-left: 5px; padding-right: 5px; border-collapse: collapse; border-top: black 1px solid; border-right: black 1px solid">
  <b>should return the expected type : Failed</b>
  For IndexType`1.Item[4], expected [6] but found [5]. 
</div>
</pre>

<h3 id="-5"> </h3>

<h3 id="comparing-partial-objects">Comparing Partial Objects</h3>

<pre class="prettyprint">public class when_retrieving_a_customer
{
	static Customer _actual;
	static ExpectedObject _expected;

	Establish context = () =&gt;
		{
			_expected = new
				            {
				            	Name = "Jane Doe",
				            	Address = new
				            		          {
				            		          	City = "Austin"
				            		          }
				            }.ToExpectedObject();

			_actual = new Customer
				          {
				          	Name = "John Doe",
				          	PhoneNumber = "5128654242",
				          	Address = new Address
				          		          {
				          		          	AddressLineOne = "456 Street",
				          		          	AddressLineTwo = "Apt. 3",
				          		          	City = "Waco",
				          		          	State = "TX",
				          		          	Zipcode = "76701"
				          		          }
				          };
		};

	It should_have_the_correct_name_and_address = () =&gt; _expected.ShouldMatch(_actual);
}
</pre>

<p>Results:</p>

<pre>
  <b>should have the correct name and address : Failed</b>
  For Customer.Name, expected "Jane Doe" but found "John Doe".
  For Customer.Address.City, expected "Austin" but found "Waco".
  </pre>

<h3>
    &nbsp;
  </h3>

<h2>
    Extensibility
  </h2>

<p>
    The Expected Objects library is extensible, so if it doesn’t provide the exact comparison strategies you need then you’re free to add our own.
  </p>

<p>
    The main extensibility point is the IComparisonStrategy which is declared as follows:
  </p>

<pre class="prettyprint">
public interface IComparisonStrategy
{
    bool CanCompare(Type type);
    bool AreEqual(object expected, object actual, IComparisonContext comparisonContext);
}
</pre>

<p>
    To register a custom strategy, simply call the Configure() method and use the supplied ConfigurationContext to call the PushStrategy<t>() method:
  &lt;/p&gt;
  
  
  <pre class="prettyprint">
_expected = new Foo("Bar")
	.ToExpectedObject()
	.Configure(ctx =&gt; ctx.PushStrategy&lt;FooComparisonStrategy&gt;());
</pre>
  
  
  <p>
    This will push the custom strategy onto the stack used by the Expected Objects library during its comparisons.
  </p>
  
  
  <h2>
    Custom Comparison Strategy Example
  </h2>
  
  
  <p>
    The following demonstrates how the Expected Objects library could be extended to compare an expected object to the contents of a Web page.
  </p>
  
  
  <p>
    Consider the following specification:
  </p>
  
  
  <pre class="prettyprint">
public class when_displaying_the_customer_view
{
	static Mock&lt;IWebDriver&gt; _actual;
	static ExpectedObject _expected;

	Establish context = () =&gt;
		{
			var nameElementStub = new Mock&lt;IWebElement&gt;();
			nameElementStub.Setup(x =&gt; x.Text).Returns("Jane Doe");
			var addressElementStub = new Mock&lt;IWebElement&gt;();
			addressElementStub.Setup(x =&gt; x.Text).Returns("456 Street");
			var buttonElementStub = new Mock&lt;IWebElement&gt;();
			buttonElementStub.Setup(x =&gt; x.Text).Returns("Cancel");
			_actual = new Mock&lt;IWebDriver&gt;();
			_actual.Setup(x =&gt; x.FindElement(By.Id("name"))).Returns(nameElementStub.Object);
			_actual.Setup(x =&gt; x.FindElement(By.CssSelector("input[name='address']"))).Returns(addressElementStub.Object);
			_actual.Setup(x =&gt; x.FindElement(By.XPath("//input[@value='submit']"))).Returns(buttonElementStub.Object);

			_expected = new ExpectedView()
				.WithId("name", "John Doe")
				.WithCssSelector("input[name='address']", "123 Street")
				.WithXPath("//input[@value='submit']", "Submit")
				.ToExpectedObject()
				.Configure(ctx =&gt;
					{
						ctx.PushStrategy&lt;ExpecedViewComparisonStrategy&gt;();
						ctx.IgnoreTypes();
					});
		};

	It should_display_the_expected_view = () =&gt; _expected.ShouldEqual(_actual.Object);
}
</pre>
  
  
  <p>
    Here, the Selenium 2 IWebDriver type is being stubbed to emulate an active Selenium testing session. Next, a custom ExpectedView type is instantiated and configured to expect one value to be located by an Id, one by a CSS Selector and one by an XPath. Lastly, the expected object is compared to the actual object (in this case, the IWebDriver stub).
  </p>
  
  
  <p>
    Executing the specification produces the following results:
  </p>
  
  
  <pre>


<div style="overflow: auto; border-bottom: black 1px solid; text-align: left; border-left: black 1px solid; padding-bottom: 5px; background-color: #fcc; padding-left: 5px; padding-right: 5px; border-collapse: collapse; border-top: black 1px solid; border-right: black 1px solid">
  <b>should display the expected view : Failed</b>
  For IWebDriverProxy.FindElement(By.Id("name")), expected "John Doe" but found "Jane Doe".
  For IWebDriverProxy.FindElement(By.CssSelector("input[name='address']")), expected "123 Street" but found "456 Street".
  For IWebDriverProxy.FindElement(By.XPath("//input[@value='submit']")), expected "Submit" but found "Cancel".
</div>
</pre>
  
  
  <h3>
    &nbsp;
  </h3>
  
  
  <p>
    Here is the ExpectedView and ExpectedViewComparisonStrategy implementation:
  </p>
  
  
  <pre class="prettyprint">
class ExpectedView
{
	public ExpectedView()
	{
		Ids = new List&lt;Tuple&lt;string, string&gt;&gt;();
		CssSelectors = new List&lt;Tuple&lt;string, string&gt;&gt;();
		XPaths = new List&lt;Tuple&lt;string, string&gt;&gt;();
	}

	public List&lt;Tuple&lt;string, string&gt;&gt; Ids { get; private set; }
	public List&lt;Tuple&lt;string, string&gt;&gt; CssSelectors { get; private set; }
	public List&lt;Tuple&lt;string, string&gt;&gt; XPaths { get; private set; }

	public ExpectedView WithId(string name, string value)
	{
		Ids.Add(new Tuple&lt;string, string&gt;(name, value));
		return this;
	}

	public ExpectedView WithCssSelector(string selector, string value)
	{
		CssSelectors.Add(new Tuple&lt;string, string&gt;(selector, value));
		return this;
	}

	public ExpectedView WithXPath(string path, string value)
	{
		XPaths.Add(new Tuple&lt;string, string&gt;(path, value));
		return this;
	}
}



class ExpecedViewComparisonStrategy : IComparisonStrategy
{
	public bool CanCompare(Type type)
	{
		return typeof (ExpectedView).IsAssignableFrom(type);
	}

	public bool AreEqual(object expected, object actual, IComparisonContext comparisonContext)
	{
		bool areEqual = true;
		var view = (ExpectedView) expected;
		var driver = (IWebDriver) actual;
		view.Ids.ForEach(id =&gt; areEqual = CompareIds(driver, id, comparisonContext) &amp;&amp; areEqual);
		view.CssSelectors.ForEach(selector =&gt; areEqual = CompareCssSelectors(driver, selector, comparisonContext) &amp;&amp; areEqual);
		view.XPaths.ForEach(path =&gt; areEqual = CompareXPaths(driver, path, comparisonContext) &amp;&amp; areEqual);
		return areEqual;
	}

	static bool CompareIds(IWebDriver driver, Tuple&lt;string, string&gt; expected, IComparisonContext comparisonContext)
	{
		bool areEqual = true;
		IWebElement idElement = driver.FindElement(By.Id(expected.Item1));
		areEqual = comparisonContext.AreEqual(expected.Item2, idElement.Text, "FindElement(By.Id(\"" + expected.Item1 + "\"))") &amp;&amp; areEqual;
		return areEqual;
	}

	static bool CompareCssSelectors(IWebDriver driver, Tuple&lt;string, string&gt; expected, IComparisonContext comparisonContext)
	{
		bool areEqual = true;
		IWebElement idElement = driver.FindElement(By.CssSelector(expected.Item1));
		areEqual = comparisonContext.AreEqual(expected.Item2, idElement.Text, "FindElement(By.CssSelector(\"" + expected.Item1 + "\"))") &amp;&amp; areEqual;
		return areEqual;
	}

	static bool CompareXPaths(IWebDriver driver, Tuple&lt;string, string&gt; expected, IComparisonContext comparisonContext)
	{
		bool areEqual = true;
		IWebElement idElement = driver.FindElement(By.XPath(expected.Item1));
		areEqual = comparisonContext.AreEqual(expected.Item2, idElement.Text, "FindElement(By.XPath(\"" + expected.Item1 + "\"))") &amp;&amp; areEqual;
		return areEqual;
	}
}
</pre>
  
  
  <p>
    Note: This example is for demonstration purposes only.
  </p>
  
  
  <h3>
    &nbsp;
  </h3>
  
  
  <h2>
    Conclusion
  </h2>
  
  
  <p>
    The Expected Objects library is published as a <a href="http://nuget.org/List/Packages/ExpectedObjects">NuGet package</a> and the source is hosted on <a href="https://github.com/derekgreer/expectedObjects">github</a>. Feel free to provide feedback.
  </p>
</t></p>
</span>
</div>

<!--<div class="box">-->
    <!-- google ads code box -->
<!--</div>-->




  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'aspiringcraftsman'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






      </div>

      <div class="tile is-4 is-child">
        <div class="tile is-parent is-vertical sidebar">

          <div class="tile is-child widget">

            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Recent Posts
                </p>
              </header>
              <div class="card-content">
                <div class="content nice-text">
                  <ul>
                  
                  <li><a href="/2017/05/25/hello-react-a-beginners-setup-tutorial/">
                    Hello, React! - A Beginner's Setup Tutorial
                  </a></li>
                  
                  <li><a href="/2016/08/30/exploring-typescript/">
                    Exploring TypeScript
                  </a></li>
                  
                  <li><a href="/2016/08/22/git-on-windows-whence-cometh-configuration/">
                    Git on Windows: Whence Cometh Configuration
                  </a></li>
                  
                  <li><a href="/2016/02/28/separation-of-concerns-application-builds-continuous-integration/">
                    Separation of Concerns: Application Builds & Continuous Integration
                  </a></li>
                  
                  <li><a href="/2015/11/01/survey-of-entity-framework-unit-of-work-patterns/">
                    Survey of Entity Framework Unit of Work Patterns
                  </a></li>
                  
                  <li><a href="/2015/03/08/introducing-nunit-specifications/">
                    Introducing NUnit.Specifications
                  </a></li>
                  
                  <li><a href="/2014/03/05/being-agile/">
                    Being Agile
                  </a></li>
                  
                  <li><a href="/2013/11/17/expected-objects-custom-comparisons/">
                    Expected Objects Custom Comparisons
                  </a></li>
                  
                  <li><a href="/2013/04/17/rabbitbus-an-example/">
                    RabbitBus: An Example
                  </a></li>
                  
                  <li><a href="/2013/01/27/adventures-in-debugging-the-nhibernate-dont-flush-the-session-error/">
                    Adventures in Debugging: The NHibernate 'don't flush the Session' Error
                  </a></li>
                  
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="tile is-child widget">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Recommended Websites
                </p>
              </header>
              <div class="card-content">
                <div class="content nice-text">
                  <ul>
                    <li>
                      <a href="https://lostechies.com">Los Techies</a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
</div>

<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
      <a class="icon" href="https://github.com/derekgreer">
          <i class="fa fa-github" title="Github"></i>
        </a>
        <a class="icon" href="https://in.linkedin.com/in/derekgreer">
          <i class="fa fa-linkedin" title="Linkedin"></i>
        </a>
        <a class="icon" href="mailto:dbgreer@gmail.com">
          <i class="fa fa-envelope" title="Email"></i>
        </a>
      </p>
    </div>
  </div>
</footer>

<!-- js -->
<script src="/assets/js/custom.js"></script>
<script src="/assets/js/typewriter.js"></script>
</body>
</html>
