<!DOCTYPE html>
<html lang="en-us">

<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="stylesheet" href="/assets/css/normalize.css"/>
  <link rel="stylesheet" href="/assets/css/bulma.css"/>
  <link rel="stylesheet" href="/assets/css/highlight.css"/>
  <link rel="stylesheet" href="/assets/css/custom.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet">

  <!-- Icons -->
  <link rel="shortcut icon" href="/assets/images/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/AspiringCraftsman">

  <title>
    
      RabbitMQ for Windows: Building Your First Application &middot; Aspiring Craftsman
    
  </title>

</head>


<body>

<section class="hero is-dark">
  <div class="hero-body">
    <div class="container">
      <h1 class="title">Aspiring Craftsman</h1><div>pursuing well-crafted software</div>
<!--
          <span class="typewrite" data-period="2000" data-type='[ "pursuing well-crafted software"]'>
            <span class="wrap"></span>
          </span>
-->
      <!--
      <h4 class="subtitle" id="quote">
      </h4>
      -->
    </div>
  </div>
</section>

<div class="main-container">
  <div class="tile is-ancestor is-vertical">


    <nav class="nav has-shadow">

      <div class="nav-left">

        <a href="/" class="nav-item">
          <span class="icon">
            <i class="fa fa-home" aria-hidden="true" title="Homepage"></i>
          </span>
        </a>

        <a href="https://github.com/derekgreer" class="nav-item">
          <span class="icon">
            <i class="fa fa-github" aria-hidden="true" title="Github"></i>
          </span>
        </a>

        <div class="nav-item" id="searchFieldNav">
          <div class="field has-addons">
            <p class="control">
              <input class="input is-small" type="text" placeholder="Find an article" id="search-text">
            </p>
            <p class="control">
              <a class="button is-dark is-small" onclick="searchHandler();">
                Search
              </a>
            </p>
          </div>
        </div>

      </div>

      <div class="nav-right nav-menu" id='nav-menu'>
        <a href="/archive" class="nav-item">Archive</a>
        <a href="/tags" class="nav-item">Tags</a>
        <a href="/about" class="nav-item">About</a>
        <a href="http://feeds.feedburner.com/AspiringCraftsman" class="nav-item"><img src="/assets/images/rss.png"/></a>
      </div>

      <span class="nav-toggle" id="nav-toggle">
          <span></span>
          <span></span>
          <span></span>
    </nav>

    <div class="tile is-parent">
      <div class="tile is-8 is-child main">

        <div class="box">
    <h1 class="post-title">RabbitMQ for Windows: Building Your First Application</h1>
    <span class="post-meta">8 March, 2012. It was a Thursday. <a style="color:grey" href="#disqus_thread"></a></span><hr/>

    <span class="post-text"><p>This <noindex></noindex> is the second installment to the RabbitMQ for Windows series.  In our <a href="http://aspiringcraftsman.com/2012/03/05/rabbitmq-for-windows-introduction/" target="_blank">first installment</a>, we walked through getting RabbitMQ installed on a Microsoft Windows machine. In this installment, we’ll discuss a few high-level concepts and walk through creating our first RabbitMQ application.</p>

<h2 id="basic-concepts">Basic Concepts</h2>

<p>To being, let’s discuss a few basic concepts. Each of the examples we’ll be working through will have two roles represented: a <em>Producer</em> and a <em>Consumer</em>. A Producer sends messages and a Consumer receives messages.</p>

<p><em>Messages</em> are basically any blob of bytes you’d like to send. This could be a simple ASCII string, JavaScript Object Notation (JSON), or a binary-serialized object.</p>

<p>Messages are sent to <em>Queues</em>.  A Queue is a First-In-First-Out (FIFO) data structure. You can think of a queue as a sort of pipe where you put messages in one side of the pipe and the messages arrive at the other end of the pipe. </p>

<p>The following diagram depicts these concepts:</p>

<p> </p>

<p><a href="http://aspiringcraftsman.com/wp-content/uploads/2012/03/ProducerQueueConsumer_thumb5.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="ProducerQueueConsumer_thumb5" border="0" alt="ProducerQueueConsumer_thumb5" src="http://aspiringcraftsman.com/wp-content/uploads/2012/03/ProducerQueueConsumer_thumb5_thumb.png" width="419" height="227" /></a></p>

<p> </p>

<p>We’ll introduce other concepts further into the series, but that’s the basics. Let’s move on to creating our first example.</p>

<h2 id="hello-world">Hello, World!</h2>

<p>Our first application will be an obligatory “Hello World” example.  We’ll create a Publisher application which sends the string “<em>Hello, World!</em>” to a RabbitMQ queue and a Consumer application which receives the message from the queue and displays it to the console.</p>

<p>For all of our examples, we’ll be using the official RabbitMQ .Net client available <a href="http://www.rabbitmq.com/dotnet.html">here</a>.  This library is also available via <a href="http://nuget.org/">NuGet</a>, so if you have the <a href="http://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c">NuGet Package Manager</a> installed you can retrieve it through the “Tools-&gt;Library Package Manager” menu item, or if you have the <a href="http://nuget.codeplex.com/releases/view/58939" target="_blank">NuGet.exe command line utility</a> then you can issue the following command in the directory you’d like it installed to:</p>

<p>&lt;/b&gt;</p>

<pre class="prettyprint">nuget install RabbitMQ.Client
</pre>

<p> </p>

<h3 id="create-the-producer">Create the Producer</h3>

<p>To start, let’s create a new empty solution named HelloWorldExample (File-&gt;New-&gt;Project-&gt;Other Project Types-&gt;Visual Studio Solutions-&gt;Blank Solution). Once you have that created, add a new project of type “Console Application” to the solution and name it “Producer”.</p>

<p>Next, add a reference to the RabbitMQ.Client.dll assembly.</p>

<p>The first thing we’ll need to do for our producer is to establish a connection to the RabbitMQ server using a ConnectionFactory:</p>

<pre class="prettyprint">namespace Producer
{
  class Program
  {
    static void Main(string[] args)
    {
      var connectionFactory = new ConnectionFactory();
      IConnection connection = connectionFactory.CreateConnection();
    }
  }
}
</pre>

<p> </p>

<p>The ConnectionFactory has a number of properties that can be set for our connection. In this example, we’re establishing a connection using the default connection settings which assumes you have the RabbitMQ Windows service running on your local development machine. If you’ve installed it on a different machine then you’ll need to set the Host property of the connectionFactory instance to the DNS name where you’ve installed RabbitMQ.</p>

<p>Next, we need to create a Channel:</p>

<pre class="prettyprint">IModel channel = connection.CreateModel();
</pre>

<p> </p>

<p>A channel is a light-weight connection which RabbitMQ uses to enable multiple threads of communication over a single TCP/IP socket. Note that the actual type created is <em>RabbitMQ.Client.IModel</em>. In most RabbitMQ client libraries the term channel is used, but for some reason the authors of the .Net client library chose to use the term “Model”. Descriptive, eh? We’ll use the instance name of “channel” to be more descriptive.</p>

<p>Next, we need to create a queue:</p>

<pre class="prettyprint">channel.QueueDeclare(“hello-world-queue”, false, false, false, null);
</pre>

<p> </p>

<p>This creates a queue on the server named “<em>hello-world-queue</em>” which is non-durable (won’t survive a server restart), is non- exclusive (other channels can connect to the same queue), and is not auto-deleted once it’s no longer being used.  We’ll discuss these parameters in more detail further in our series.</p>

<p>Next, we’ll declare a byte array containing a UTF8-encoded array of bytes from the string “Hello, World!” and use the BasicPublish() method to publish the message to the queue:</p>

<pre class="prettyprint">byte[] message = Encoding.UTF8.GetBytes("Hello, World!");
channel.BasicPublish(string.Empty, “hello-world-queue”, null, message);
</pre>

<p> </p>

<p>Again, don’t worry about understanding the parameters just yet. We’ll get to that soon enough.</p>

<p>Finally, we’ll prompt the user to press a key to exit the application and close our channel and connection:</p>

<pre class="prettyprint">Console.WriteLine("Press any key to exit");
Console.ReadKey();
channel.Close();
connection.Close();
</pre>

<p> </p>

<p>Here’s the full Producer listing:</p>

<pre class="prettyprint">using System.Text;
using RabbitMQ.Client;

namespace Producer
{
  class Program
  {
    static void Main(string[] args)
    {
      var connectionFactory = new ConnectionFactory();
      IConnection connection = connectionFactory.CreateConnection();
      IModel channel = connection.CreateModel();
      channel.QueueDeclare("hello-world-queue", false, false, false, null);
      byte[] message = Encoding.UTF8.GetBytes("Hello, World!");
      channel.BasicPublish(string.Empty, "hello-world-queue", null, message);
      Console.WriteLine("Press any key to exit");
      Console.ReadKey();
      channel.Close();
      connection.Close();
    }
  }
}
</pre>

<p> </p>

<h3 id="create-the-consumer">Create the Consumer</h3>

<p>Next, let’s create our Consumer application. Add a new Console Application to the solution named “Consumer” and add a reference to the RabbitMQ.Client assembly. We’ll start our consumer with the same connection, channel, and queue declarations:</p>

<pre class="prettyprint">var connectionFactory = new ConnectionFactory();
IConnection connection = connectionFactory.CreateConnection();
IModel channel = connection.CreateModel();
channel.QueueDeclare("hello-world-queue", false, false, false, null);
</pre>

<p> </p>

<p>Next, we’ll use the BasicGet() method to consume the message from the queue “hello-world-queue”:</p>

<pre class="prettyprint">BasicGetResult result = channel.BasicGet("hello-world-queue", true);
</pre>

<p> </p>

<p>Next, we’ll check to ensure we received a result. If so, we’ll convert the byte array contained within the Body property to a string and display it to the console:</p>

<pre class="prettyprint">if (result != null)
{
  string message = Encoding.UTF8.GetString(result.Body);
  Console.WriteLine(message);
}
</pre>

<p> </p>

<p>Lastly, we’ll prompt the user to press a key to exit the application and close our channel and connection:</p>

<pre class="prettyprint">Console.WriteLine("Press any key to exit");
Console.ReadKey();
channel.Close();
connection.Close();
</pre>

<p> </p>

<p>Here’s the full Consumer listing:</p>

<pre class="prettyprint">using System;
using System.Text;
using RabbitMQ.Client;

namespace Consumer
{
  class Program
  {
    static void Main(string[] args)
    {
      var connectionFactory = new ConnectionFactory();
      IConnection connection = connectionFactory.CreateConnection();
      IModel channel = connection.CreateModel();
      channel.QueueDeclare("hello-world-queue", false, false, false, null);
      BasicGetResult result = channel.BasicGet("hello-world-queue", true);
      if (result != null)
      {
        string message = Encoding.UTF8.GetString(result.Body);
        Console.WriteLine(message);
      }
      Console.WriteLine("Press any key to exit");
      Console.ReadKey();
      channel.Close();
      connection.Close();
    }
  }
}
</pre>

<p> </p>

<p>To see the application in action, start the Publisher application first and then start the Consumer application. If all goes well, you should see the Consumer application print the following:</p>

<pre class="prettyprint">Hello, World!
Press any key to exit
</pre>

<p> </p>

<p>Congratulations! You’ve just completed your first RabbitMQ application.  Next time, we’ll take a closer look at the concepts used within our Hello World example.</p>

<pre></pre>
</span>
</div>

<!--<div class="box">-->
    <!-- google ads code box -->
<!--</div>-->




  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'aspiringcraftsman'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






      </div>

      <div class="tile is-4 is-child">
        <div class="tile is-parent is-vertical sidebar">

          <div class="tile is-child widget">

            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Recent Posts
                </p>
              </header>
              <div class="card-content">
                <div class="content nice-text">
                  <ul>
                  
                  <li><a href="/2017/05/25/hello-react-a-beginners-setup-tutorial/">
                    Hello, React! - A Beginner's Setup Tutorial
                  </a></li>
                  
                  <li><a href="/2016/08/30/exploring-typescript/">
                    Exploring TypeScript
                  </a></li>
                  
                  <li><a href="/2016/08/22/git-on-windows-whence-cometh-configuration/">
                    Git on Windows: Whence Cometh Configuration
                  </a></li>
                  
                  <li><a href="/2016/02/28/separation-of-concerns-application-builds-continuous-integration/">
                    Separation of Concerns: Application Builds & Continuous Integration
                  </a></li>
                  
                  <li><a href="/2015/11/01/survey-of-entity-framework-unit-of-work-patterns/">
                    Survey of Entity Framework Unit of Work Patterns
                  </a></li>
                  
                  <li><a href="/2015/03/08/introducing-nunit-specifications/">
                    Introducing NUnit.Specifications
                  </a></li>
                  
                  <li><a href="/2014/03/05/being-agile/">
                    Being Agile
                  </a></li>
                  
                  <li><a href="/2013/11/17/expected-objects-custom-comparisons/">
                    Expected Objects Custom Comparisons
                  </a></li>
                  
                  <li><a href="/2013/04/17/rabbitbus-an-example/">
                    RabbitBus: An Example
                  </a></li>
                  
                  <li><a href="/2013/01/27/adventures-in-debugging-the-nhibernate-dont-flush-the-session-error/">
                    Adventures in Debugging: The NHibernate 'don't flush the Session' Error
                  </a></li>
                  
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div class="tile is-child widget">
            <div class="card">
              <header class="card-header">
                <p class="card-header-title nice-title">
                  Recommended Websites
                </p>
              </header>
              <div class="card-content">
                <div class="content nice-text">
                  <ul>
                    <li>
                      <a href="https://lostechies.com">Los Techies</a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
</div>

<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
      <a class="icon" href="https://github.com/derekgreer">
          <i class="fa fa-github" title="Github"></i>
        </a>
        <a class="icon" href="https://in.linkedin.com/in/derekgreer">
          <i class="fa fa-linkedin" title="Linkedin"></i>
        </a>
        <a class="icon" href="mailto:dbgreer@gmail.com">
          <i class="fa fa-envelope" title="Email"></i>
        </a>
      </p>
    </div>
  </div>
</footer>

<!-- js -->
<script src="/assets/js/custom.js"></script>
<script src="/assets/js/typewriter.js"></script>
</body>
</html>
